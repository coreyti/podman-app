#!/usr/bin/env bash
set -euo pipefail

: ${PROJECT:?'UNDEFINED - Be sure to `direnv allow` first'}

export CONTAINER_HOST=ssh://vagrant@127.0.0.1:2222/run/podman/podman.sock
# export CONTAINER_SSHKEY=${PROJECT}/etc/.vagrant/machines/default/virtualbox/private_key
export CONTAINER_SSHKEY=${PROJECT}/etc/.ssh/id_rsa
export VAGRANT_CWD=${PROJECT}/etc

action=$1

case $action in
  "rebuild")
    echo "Rebuilding podman..."
    vagrant destroy
    vagrant up
    ;;

  "start")
    echo "Starting podman..."
    vagrant up
    ;;

  "stop")
    echo "Stopping podman..."
    vagrant halt
    ;;
esac
